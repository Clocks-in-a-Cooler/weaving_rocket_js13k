const canvas=document.querySelector("canvas"),context=canvas.getContext("2d"),canvas_size=Math.min(window.innerWidth,window.innerHeight)-2;canvas.width=canvas.height=canvas_size;class Sprite{constructor(e){this.img=new Image,this.img.src=e,this.width=this.img.width,this.height=this.img.height}}function fill_text_with_background(e,t,i,a,s,n,o){var c,r=e.measureText(t),l=0;switch(e.textAlign){case"start":case"left":l=i;break;case"center":l=i-r.width/2;break;case"right":case"end":l=i-r.width}l-=s,c=a-r.actualBoundingBoxAscent-s;var h=r.width+2*s,_=r.actualBoundingBoxAscent+r.actualBoundingBoxDescent+2*s;e.save(),e.fillStyle=n,e.fillRect(l,c,h,_),e.fillStyle=o,e.fillText(t,i,a),e.restore()}function draw(e,t,i){switch(i.clearRect(0,0,canvas_size,canvas_size),i.lineWidth=4,e.forEach(e=>{if(e.active){if(i.strokeStyle=e.colour.to_string(),e.constructor==Rocket){var t;switch(t=space_bar?e.direction:"left"==e.direction?"right":"left",i.fillStyle="lime",i.save(),i.translate(e.position.x,e.position.y),i.beginPath(),t){case"left":i.moveTo(-30,15),i.lineTo(-30,-15),i.lineTo(-45,0);break;case"right":i.moveTo(30,15),i.lineTo(30,-15),i.lineTo(45,0)}if(i.closePath(),i.fill(),i.restore(),Math.floor(e.invincibility/200)%2)return}i.beginPath(),i.shadowColor=e.colour.to_string(),i.shadowBlur=80,e.get_lines().forEach(e=>{i.moveTo(e.start.x,e.start.y),i.lineTo(e.end.x,e.end.y)}),i.closePath(),i.stroke()}}),t.forEach(e=>{i.strokeStyle=e.colour.to_string(),i.beginPath(),i.moveTo(e.start.x,e.start.y),i.lineTo(e.end.x,e.end.y),i.closePath(),i.stroke()}),i.save(),game_state){case"menu":i.font="30px sans-serif",i.textAlign="center",fill_text_with_background(i,"weaving rocket",canvas_size/2,canvas_size/2,3,"black","white"),i.font="15px sans-serif",fill_text_with_background(i,"use the SPACE BAR to weave in between the asteroids",canvas_size/2,canvas_size/2+40,"black","white"),frames%60<30&&(i.font="15px sans-serif",fill_text_with_background(i,"press SPACE to start",canvas_size/2,canvas_size/2+80,"black","white"));break;case"game over":i.font="30px sans-serif",i.textAlign="center",fill_text_with_background(i,"GAME OVER",canvas_size/2,canvas_size/2,3,"black","white"),frames%60<30&&(i.font="15px sans-serif",fill_text_with_background(i,"press SPACE to restart",canvas_size/2,canvas_size/2+40,"black","white"));break;case"playing":if(null==player)break;i.font="25px sans-serif",i.textAlign="left",i.textBaseline="top",fill_text_with_background(i,`health: ${player.health}`,3,3,5,"black","white"),fill_text_with_background(i,`score: ${score}`,3,41,5,"black","white"),high_score&&fill_text_with_background(i,`best: ${high_score}`,3,79,5,"black","white")}i.restore(),frames++}