class Colour{constructor(t,e,i,s=1){this.r=t,this.g=e,this.b=i,this.a=s}to_string(){return`rgba(${this.r}, ${this.g}, ${this.b}, ${this.a})`}clone(t=0,e=0,i=0,s=0){return new Colour(this.r+t,this.g+e,this.b+i,this.a+s)}}class Vector{constructor(t,e){this.x=t,this.y=e}get length(){return Math.hypot(this.x,this.y)}get angle(){var t=Math.acos(this.x/this.length);return this.y>0?t:-t}to_string(){return`(${this.x}, ${this.y})`}add(t){return new Vector(this.x+t.x,this.y+t.y)}subtract(t){return new Vector(this.x-t.x,this.y-t.y)}multiply(t){return new Vector(this.x*t,this.y*t)}scale(t){var e=t/this.length;return this.multiply(e)}}class Line{constructor(t,e){this.start=t,this.end=e}get vector(){return this.end.subtract(this.start)}get length(){return this.end.subtract(this.start).length}get midpoint(){return new Vector((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)}static create_line(t,e,i,s){return new Line(new Vector(t,e),new Vector(i,s))}translate(t){return new Line(this.start.add(t),this.end.add(t))}rotate(t,e){var i=this.start.x,s=this.start.y,r=this.end.x,o=this.end.y,n=t.x,h=t.y,a=(i-n)*Math.cos(e)-(s-h)*Math.sin(e)+n,c=(i-n)*Math.sin(e)+(s-h)*Math.cos(e)+h,_=(r-n)*Math.cos(e)-(o-h)*Math.sin(e)+n,l=(r-n)*Math.sin(e)+(o-h)*Math.cos(e)+h;return new Line(new Vector(a,c),new Vector(_,l))}collision(t){var e=this.start.x,i=this.start.y,s=this.end.x,r=this.end.y,o=t.start.x,n=t.start.y,h=t.end.x,a=t.end.y,c=(h-o)*(r-i)-(s-e)*(a-n);if(0==c)return!1;var _=((h-o)*(n-i)-(o-e)*(a-n))/c,l=((s-e)*(n-i)-(o-e)*(r-i))/c;return _>=0&&_<=1&&l>=0&&l<=1?this.start.add(this.vector.multiply(_)):null}}const LINE_PARTICLE_MOVE_SPEED=.03,LINE_PARTICLE_ROTATE_SPEED=Math.PI/6e3,LINE_PARTICLE_MAX_LIFETIME=750;class Line_particle extends Line{constructor(t,e){super(t.start,t.end),this.colour=e.clone(),this.motion=new Vector(Math.random()*LINE_PARTICLE_MOVE_SPEED,Math.random()*LINE_PARTICLE_MOVE_SPEED),this.rotation=(Math.random()<.5?-1:1)*Math.random()*LINE_PARTICLE_ROTATE_SPEED,this.motion.x*=Math.random()<.5?-1:1,this.motion.y*=Math.random()<.5?-1:1,this.lifetime=LINE_PARTICLE_MAX_LIFETIME}update(t){var e=this.rotate(this.midpoint,this.rotation*t).translate(this.motion.multiply(t));this.start=e.start,this.end=e.end,this.lifetime-=t,this.colour.a=this.lifetime/LINE_PARTICLE_MAX_LIFETIME}}class Entity{constructor(t,e,i){this.position=t,this.angle=isNaN(i)?0:i,this.lines=e,this.health=1,this.active=!0,this.colour=new Colour(255,255,255)}get_lines(){var t=this.position,e=this.angle;return this.lines.map(i=>i.translate(t).rotate(t,e))}get_position(){return this.position}static create_entity(t,e,i){i=isNaN(i)?0:i;var s=e.map((e,i,s)=>new Line(s[i],s[(i+1)%s.length]).translate(t.multiply(-1)));return new Entity(t,s,i)}collision(t){var e=[];return this.get_lines().forEach(i=>{t.get_lines().forEach(t=>{var s=i.collision(t);s&&e.push(s)})}),e.length?e:null}update(t,e){}shatter(){this.get_lines().forEach(t=>{particles.push(new Line_particle(t,this.colour))}),this.active=!1}}var entities=[],particles=[];const ASTEROID_SIDE_LENGTH=20;var asteroid_move_speed=.2,asteroid_rotation_speed=.001;class Asteroid extends Entity{constructor(t,e,i){for(var s=new Vector(t,-100),r=[],o=2*Math.PI/e,n=.5*ASTEROID_SIDE_LENGTH/Math.sin(o/2),h=0;h<e;h++){var a=h*o,c=new Vector(Math.cos(a)*n,Math.sin(a)*n),_=new Vector(Math.cos(a+o)*n,Math.sin(a+o)*n);r.push(new Line(c,_))}super(s,r,0),this.colour=i,this.speed=.1*Math.random()+asteroid_move_speed,this.rotate_direction=Math.random()<.5?-1:1}update(t,e){this.position.y+=t*this.speed,this.angle+=t*asteroid_rotation_speed*this.rotate_direction,this.active=this.active&&this.position.y-100<canvas_size}}const ROCKET_LINES=[new Line(new Vector(0,-30),new Vector(15,30)),new Line(new Vector(15,30),new Vector(0,15)),new Line(new Vector(0,15),new Vector(-15,30)),new Line(new Vector(-15,30),new Vector(0,-30))],ROCKET_MOVE_SPEED=.3,ROCKET_LEAN_ANGLE=Math.PI/6,ROCKET_ACCELERATION=5e-4,ROCKET_FRICTION=.0015;var rocket_shield=0,rocket_gun=0,fire_gun=!1,rocket_totem=!1;class Rocket extends Entity{constructor(){super(new Vector(canvas_size/2,canvas_size-50),ROCKET_LINES,0),this.colour=new Colour(173,255,47),this.invincibility=3e3,this.direction="left",this.x_speed=0,this.health=5,rocket_gun=8}receive_powerup(t){switch(t){case"shield":rocket_shield=6e3,this.set_colour(new Colour(255,255,255));break;case"gun":rocket_gun=16;break;case"totem":rocket_totem=!0}}get_colour(){return this.colour}set_colour(t){this.colour=t}update(t,e){if(this.invincibility=this.invincibility<=0?0:this.invincibility-t,rocket_shield=rocket_shield<=0?0:rocket_shield-t,space_bar&KEY_PRESSED){switch(zzfx(,,22,.08,.4,0,2,.29,-.3,,,,.02,,,.2,,.4,.05),this.direction){case"right":this.direction="left";break;case"left":this.direction="right"}space_bar=KEY_SEEN}if(space_bar)switch(this.direction){case"right":this.x_speed+=ROCKET_ACCELERATION*t;break;case"left":this.x_speed-=ROCKET_ACCELERATION*t}if(this.position.x+=this.x_speed*t,this.angle=ROCKET_LEAN_ANGLE*this.x_speed/ROCKET_MOVE_SPEED,this.x_speed-=this.x_speed*t*ROCKET_FRICTION,this.position.x=Math.max(30,Math.min(this.position.x,canvas_size-30)),e.forEach(t=>{t!==this&&t.collision(this)&&(t.constructor==Asteroid?(t.shatter(),this.invincibility<=0&&rocket_shield<=0&&(this.shatter(),this.health--,this.active=!0,this.invincibility=1e3),rocket_shield<=0?zzfx(1.99,,212,.13,.04,.09,3,2.36,,,,,,,-95,,.44,.35,.01):zzfx(1.58,,65.40639,.21,.07,.13,,1.95,-.2,4,,,,2,,.4,.1,.82,.05,.02)):t.constructor==Powerup&&(t.shatter(),zzfx(1.1,,246.9417,.03,.36,.92,,1.25,.2,-.5,-290,.1,.1,,,,,.88,.07),this.receive_powerup(t.get_power_type())))}),Math.round(rocket_shield)%100==0&&rocket_shield>0?this.set_colour(this.get_colour().clone(-5,-5,-5)):rocket_shield<=0&&this.set_colour(new Colour(173,255,47)),frames%120==0&&rocket_gun>0&&(fire_gun=!0,zzfx(.5,,247,.02,.07,.03,1,.26,-7.9,-.1,,,,.6,,.4,,.71,.02,.4),rocket_gun--),this.health<=0){if(rocket_totem)return this.health=1,rocket_totem=!1,this.invincibility=2e3,void zzfx(2.5,0,261.6256,,.85,.14,2,1.57,,,,,.38,.3,,,.18,.76,.16,.25);this.active=!1,game_state="game over",score>high_score&&(high_score=score)}}}class Powerup extends Entity{constructor(t,e,i){for(var s=new Vector(t,-100),r=2*Math.PI/3,o=[],n=0;n<3;++n){var h=n*r,a=new Vector(20*Math.cos(h),20*Math.sin(h)),c=new Vector(20*Math.cos(h+r),20*Math.sin(h+r));o.push(new Line(a,c))}super(s,o,0),this.power_type=e,this.colour=i,this.speed=1.6*(.1*Math.random()+asteroid_move_speed),this.rotate_direction=-1}get_power_type(){return this.power_type}update(t,e){this.position.y+=t*this.speed,this.angle+=t*(25*asteroid_rotation_speed)*this.rotate_direction,this.active=this.active&&this.position.y-100<canvas_size}}class Bullet extends Asteroid{constructor(){super(0,3,new Colour(27,181,89));var t=entities.filter(t=>t.constructor==Rocket)[0];this.position=t.get_position().add(new Vector(0,-60))}update(t,e){this.position.y-=t*this.speed,this.angle+=t*asteroid_rotation_speed*this.rotate_direction,this.active=this.active&&this.position.y>0,e.forEach(t=>{t.collision(this)&&t.constructor==Asteroid&&(t.shatter(),this.shatter())})}}